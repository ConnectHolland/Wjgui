var WJGuiSettings=Object.extend({windowBaseTitle:"Windmill CMS"},WJGuiSettings||{});var WJWindow=Class.create({DEFAULT_PARENT:document.body,initialize:function(callback,parent,translate){this._loading=false;this._basetitle=this._title="";this._theme="default";this._parent=parent||WJWindow.DEFAULT_PARENT||document.body;this._listeners=new Hash();this.translate=translate||this.translate;this._createWindow();this._addDefaultListeners();this._addCloseButton();this.setCallback(callback);this.setBaseTitle(WJGuiSettings.windowBaseTitle);},_createWindow:function(){var classname=this._getBaseClassname();this._windowElement=new Element("div",{"class":classname});this._windowElement.setStyle({"display":"none"});this._createWindowRows(["title","main","buttons","bottom"],classname);this._windowElementId=this._windowElement.identify();this._parent.insert(this._windowElement);this._absolutizeTopLeft();this.hide();this._outerElement=this._windowElement;this.setTheme();},insertWindowRowBefore:function(rowname,newrowname){if(rowname==="title"){return;}
var classname=this._getBaseClassname();var row=this._windowElement.select("."+classname+"_"+rowname)
row=row.first();var newrowhtml=this._createRow(newrowname,classname," "+classname+"_body");var div=new Element("div");div.update(newrowhtml);var toprow=row.parentNode;var newrow=toprow.insertBefore(div.firstChild,row);newrow=Element.extend(newrow);newrow=newrow.select("."+classname+"_content");this._contentElements[newrowname]=newrow.first();return newrow;},replaceWindowRow:function(oldrow,newrow){var inserted=this.insertWindowRowBefore(oldrow,newrow);var toremove=this.getContentElement(oldrow);this._contentElements[oldrow]=this._contentElements[newrow];return toremove.remove();},_addCloseButton:function(){var title=this.getContentElement("title");title.appendChild(new Element("div",{"class":this._getBaseClassname()+"_closebutton","onclick":"this.parentNode.getWJWindowObject().fireClose(this)","title":this.translate("CLOSE_WINDOW")}));},fireClose:function(element){element=$(element);var func=function(){this.destroy();Event.stopObserving(document,"wjgui:close",arguments.callee.observerFunction);}
var bound=func.bindAsEventListener(this);func.observerFunction=bound;Event.observe(document,"wjgui:close",bound);element.fire("wjgui:close");Event.stopObserving.defer(document,"wjgui:close",bound);},_addDefaultListeners:function(element){this.addListener("true",this.windowResult.bindAsEventListener(this,true));this.addListener("false",this.windowResult.bindAsEventListener(this,false));this.addListener("close",this.windowResult.bindAsEventListener(this,false));this.addListener("save",this.windowResult.bindAsEventListener(this));this.addListener("delete",this.windowResult.bindAsEventListener(this));this.addListener("cancel",this.windowResult.bindAsEventListener(this));this._addDefaultKeyListener();},_addDefaultKeyListener:function(){var element=element||this._windowElement;Event.observe(element,"keydown",this.keyHandle.bindAsEventListener(this));},keyHandle:function(event){var element=event.element();if(Object.isElement(element.up(".wjgui_window"))){switch(event.keyCode){case Event.KEY_RETURN:if(this.isVisible()){element.fire("wjgui:true");}
break;case Event.KEY_ESC:if(this.isVisible()){element.fire("wjgui:close");}
break;default:return;}}},addListener:function(eventName,callback,element){WJDebugger.log(WJDebugger.INFO,"Adding listener in WJWindow",eventName,callback);var callback=callback||this.windowResult.bindAsEventListener(this);var element=element||this._windowElement;Event.observe(element,"wjgui:"+eventName,callback);this._setListener(eventName,{"element":element,"callback":callback});return this;},_setListener:function(key,elementAndCallback){this._listeners.set(key,elementAndCallback);},removeListener:function(key){var listener=this.getListener(key);Event.stopObserving(listener.element,"wjgui:"+key,listener.callback);this._listeners.unset(key);return this;},removeListeners:function(){this._listeners.each(function(info){this.removeListener(info.key);}.bind(this));return this;},windowResult:function(event){this._callback.apply(this,arguments);},getListeners:function(){return this._listeners;},getListener:function(key){return this._listeners.get(key);},_getBaseClassname:function(){return"wjgui_window";},_getWindowRowTemplate:function(){return new Template("<div class='#{classprefix}_#{rowname} #{classprefix}_row#{body}'><div class='#{classprefix}_left #{classprefix}_column'><div class='#{classprefix}_right #{classprefix}_column'><div class='#{classprefix}_center #{classprefix}_column'><div class='#{classprefix}_content'>&#160;</div></div></div></div></div>");},_createWindowRows:function(rows,classprefix,windowElement){var windowElement=windowElement||this._windowElement;rows.each(function(windowElement,classprefix,rowname,index){var body=" "+classprefix+"_body";if(index==0||index==(rows.length-1)){body="";}
windowElement.innerHTML+=this._createRow(rowname,classprefix,body);}.bind(this,windowElement,classprefix));this._saveRows(rows,classprefix,windowElement);this._addWindowObjectGetters();},_addWindowObjectGetters:function(){var test=[$H(this._contentElements).values(),this._windowElement].flatten();test.each(function(el){el.getWJWindowObject=function(){return this;}.bind(this);},this);return test;},_saveRows:function(rows,classprefix,windowElement){var windowElement=windowElement||this._windowElement;this._contentElements={};rows.each(function(windowElements,rowname,index){this._contentElements[rowname]=windowElements[index];}.bind(this,windowElement.select("."+classprefix+"_content")));return this;},_createRow:function(rowname,classprefix,body){var row=this._getWindowRowTemplate();return row.evaluate({"rowname":rowname,"classprefix":classprefix,"body":body});},getContentElement:function(rowname){return this._contentElements[rowname];},evalContentElement:function(rowname){var element=this.getContentElement(rowname);element.innerHTML.evalScripts();return this;},_absolutizeTopLeft:function(element){var element=element||this._windowElement;element.absolutize();element.setStyle({height:"",width:""});this.setX(0,element);this.setY(0,element);},_checkMaxHeight:function(element){var element=element||this.getContentElement("main");if(this.getY()+this.getHeight()>document.viewport.getHeight()){this.setHeight(document.viewport.getHeight()-this.getY(),element,false);}
else{element.setStyle({"maxHeight":""});}},show:function(element){var element=element||this._outerElement||this._windowElement;element.style.display="block";try{element.focus()}catch(e){}
return this;},hide:function(element){var element=element||this._outerElement||this._windowElement;element.style.display="none";return this;},destroy:function(element){var element=element||this._outerElement||this._windowElement;if(element.parentNode){element.remove();}
return this;},_callback:function(){if(Object.isFunction(this._callbackFunction)){var args=$A(arguments);args.unshift(this);return this._callbackFunction.apply(this._callbackFunction,args);}},_close:function(event){this.hide();},setBaseTitle:function(title){this._basetitle=title;this.setTitle(this.getTitle());return this;},setTitle:function(title){this._title=title;var headers=this.getContentElement("title").getElementsByTagName("h1");if(headers.length<1){this.getContentElement("title").innerHTML="<h1>&#160;</h1>"+this.getContentElement("title").innerHTML;return this.setTitle(this._title);}
headers[0].innerHTML=this._getComposedTitle();return this;},_getComposedTitle:function(){return this._title+((this._basetitle!=""&&this._basetitle!=this._title)?((this._title!="")?" - ":"")+this._basetitle:"");},setContent:function(content){if(Object.isString(content)){this.getContentElement("main").innerHTML=content;}
if(Object.isElement(content)){this.getContentElement("main").appendChild(content);}
this._content=content;return this;},addButton:function(caption,eventHandler,defaultButton){WJDebugger.log(WJDebugger.INFO,"Adding button to window",caption,eventHandler,this);var button=WJButton.create(caption,eventHandler,defaultButton,this.getContentElement("buttons"));this._checkMaxHeight();return button;},addStatusbar:function(){WJDebugger.log(WJDebugger.INFO,"Adding statusbar to window",this);this._statusbar=new Element("div",{"class":"wjgui_statusbar"});this.getContentElement("buttons").insert(this._statusbar);this._checkMaxHeight();},setStatusbar:function(content,fade){var fade=fade||-1;if(this._statusbar){this._statusbar.update(content);if(fade>0){this.hideStatusbar.bind(this).delay(fade);}}},hideStatusbar:function(){Effect.Fade(this._statusbar,{duration:3.0});this.clearAndShowStatusbar.bind(this).delay(3.5);},clearAndShowStatusbar:function(){this._statusbar.update("");this._statusbar.show();},setCallback:function(callback){if(Object.isFunction(callback)){this._callbackFunction=callback;}
return this;},setX:function(x,element){this._x=x||0;var element=element||this._windowElement;element.style.left=x+"px";return this;},setY:function(y,element){this._y=y||0;var element=element||this._windowElement;element.style.top=y+"px";this._checkMaxHeight(element);return this;},setZ:function(z,element){this._z=z||10000;var element=element||this._windowElement;element.style.zIndex=z;return this;},setWidth:function(width,element){this._width=width;var element=element||this._windowElement;element.setStyle({"width":width+"px"});element.fire("wjgui:resize");return this;},setHeight:function(height,element,checkHeight){this._height=height;var element=element||this.getContentElement("main");var wasVisible=this.isVisible();var origX=this.getX();var origY=this.getY();if(!wasVisible){this.setX(-10000);this.setY(-10000);this.show();}
var otherRowsHeight=0;for(var key in this._contentElements){if(key!="main"){otherRowsHeight+=this._contentElements[key].getHeight();}}
var height=(Object.isNumber(height)==false)?height:(height-otherRowsHeight)+"px";element.setStyle({"height":height});if(!wasVisible){this.hide();this.setX(origX);this.setY(origY);}
if(checkHeight!=false){this._checkMaxHeight(element);}
if(!checkHeight){element.fire("wjgui:resize");}
return this;},getBaseTitle:function(){return this._basetitle;},getTitle:function(){return this._title;},getType:function(){return this._type;},getContent:function(){return this._content;},getContenttype:function(){},getCallback:function(){return this._callbackFunction;},isVisible:function(){var xInLow=(this.getX()<0&&(this.getX()+this.getWidth())>0);var xInHigh=(this.getX()>=0&&this.getX()<document.viewport.getWidth());var yInLow=(this.getY()<0&&(this.getY()+this.getHeight())>0);var yInHigh=(this.getY()>=0&&this.getY()<document.viewport.getHeight());if((xInLow||xInHigh)&&(yInLow||yInHigh)&&this._windowElement.visible()){return true;}
return false;},getX:function(element){var element=element||this._windowElement;return parseInt(element.style.left);},getY:function(element){var element=element||this._windowElement;return parseInt(element.style.top);},getZ:function(){var element=element||this._windowElement;return element.style.zIndex;},getWidth:function(element){var element=element||this._windowElement;return element.getWidth();},getHeight:function(element){var element=element||this._windowElement;return element.getHeight();},getContentHeight:function(){return this.getContentElement("main").getHeight();},getContentWidth:function(){return this.getContentElement("main").getWidth();},getWindowElement:function(){return this._windowElement;},center:function(element){var element=element||this._windowElement;var remainsX=document.viewport.getWidth()-this.getWidth(element);var remainsY=document.viewport.getHeight()-this.getHeight(element);this.setX(remainsX/2,element).setY(remainsY/2,element);return this;},keepCentered:function(element){if(!this._centerObserver){var element=element||this._windowElement;this._centerObserver=this.center.bind(this,element);Event.observe(window,"resize",this._centerObserver);}},stopCentered:function(){Event.stopObserving(window,"resize",this._centerObserver);this._centerObserver=null;},maximize:function(paddingTop,paddingRight,paddingBottom,paddingLeft,noScroll){var paddingTop=paddingTop||0;var paddingRight=paddingRight||paddingTop;var paddingBottom=paddingBottom||paddingTop;var paddingLeft=paddingLeft||paddingTop;var noScroll=noScroll||false;this.setX(paddingLeft).setY(paddingTop);if(noScroll){this.setWidth(0).setHeight(0);}
this.setWidth(document.viewport.getWidth()-(paddingLeft+paddingRight)).setHeight(document.viewport.getHeight()-(paddingTop+paddingBottom));return this;},keepMaximized:function(){if(!this._maximizedObserver){var paddingTop=this.getY();var paddingLeft=this.getX();var paddingRight=document.viewport.getWidth()-this.getWidth()-paddingLeft;var paddingBottom=document.viewport.getHeight()-this.getHeight()-paddingTop;this._maximizedObserver=this.maximize.bind(this,paddingTop,paddingRight,paddingBottom,paddingLeft,true);Event.observe(window,"resize",this._maximizedObserver);}},stopMaximized:function(){Event.stopObserving(window,"resize",this._maximizedObserver);this._maximizedObserver=null;},setLoading:function(loading,loadCallback){var loadCallback=loadCallback||false;if(loading&&!this.getLoading()){this.getWindowElement().addClassName("wjgui_window_loading");if(!loadCallback){this.getContentElement("main").setStyle({"visibility":"hidden"});}
else{loadCallback(this,loading);}}
else if(!loading&&this.getLoading()){this.getWindowElement().removeClassName("wjgui_window_loading");if(!loadCallback){this.getContentElement("main").setStyle({"visibility":"visible"});}
else{loadCallback(this,loading);}}
this._loading=loading;return this;},getLoading:function(){return this._loading;},setTheme:function(theme){if(theme==this.getTheme()){return;}
this._removeOldTheme();this._setTheme(theme);this._addNewTheme();},_setTheme:function(theme){this._theme=theme||"default";},_removeOldTheme:function(){this.getWindowElement().removeClassName(this._getBaseClassname()+"theme_"+this.getTheme());},_addNewTheme:function(){this.getWindowElement().addClassName(this._getBaseClassname()+"theme_"+this.getTheme());},getTheme:function(){return this._theme;},translate:function(key){if(this._translations[key]){return this._translations[key];}
return key.charAt(0).toUpperCase()+key.replace("_"," ").substr(1).toLowerCase();},_translations:{OK:"OK",CANCEL:"Cancel",YES:"Yes",NO:"No",CLOSE_WINDOW:"Close window"}});WJWindow._messagedialog=function(type,message,callback,show,translate,allowHTML){var win=new WJWindow(callback,null,translate);var mwin=new window[type](win);mwin.setMessage(message,allowHTML);if(show){mwin.show();}
return mwin;};WJWindow.alert=function(message,callback,translate,allowHTML){return WJWindow._messagedialog("WJWindowAlert",message,callback,true,translate,allowHTML);};WJWindow.notice=function(message,callback,translate,allowHTML){return WJWindow._messagedialog("WJWindowNotice",message,callback,true,translate,allowHTML);};WJWindow.confirm=function(message,callback,translate,allowHTML){return WJWindow._messagedialog("WJWindowConfirm",message,callback,true,translate,allowHTML);};WJWindow.booleanConfirm=function(message,callback,translate,allowHTML){return WJWindow._messagedialog("WJWindowBooleanConfirm",message,callback,true,translate,allowHTML);};WJWindow.prompt=function(message,callback,translate,allowHTML){return WJWindow._messagedialog("WJWindowPrompt",message,callback,true,translate,allowHTML);};var WJWindowModal=Class.create({initialize:function(toDecorate){this._decorate(toDecorate);this._createModalLayer();this._maxblink=6;this._addBlinkListener();this._rebindListeners();this._rebindWindowObjectGetters();this.setZ(2147483647);this.show();},_decorate:function(toDecorate){this._decorated=toDecorate;for(property in this._decorated){if(!Object.isFunction(this[property])){this[property]=this._decorated[property];}}},_rebindListeners:function(){this.removeListeners();this._addDefaultListeners();},_createModalLayer:function(){var windowElement=this._decorated.getWindowElement();this._modalLayer=new WJModalLayer();this._modalLayer.getLayer().insert(windowElement);this._outerElement=this._modalLayer.getLayer();},show:function(element){var element=element||this._outerElement||this._modalLayer.getLayer();element.style.display="block";this._setBodyOverflow("hidden");this._decorated.show();},hide:function(element){var element=element||this._outerElement||this._modalLayer.getLayer();element.style.display="none";this._setBodyOverflow();this._decorated.hide();},_setBodyOverflow:function(value){var value=value||"";$(document.body).setStyle({overflow:value});$(document.getElementsByTagName("html")[0]).setStyle({overflow:value});},_addBlinkListener:function(){Event.observe(this._modalLayer.getLayer(),"click",this.blink.bindAsEventListener(this));},blink:function(event,doBlink,count){var count=count||0;if(Event.element(event).className==this._getBaseClassname()+"_modality"){if(doBlink){this.getWindowElement().addClassName(this._getBaseClassname()+"_blink");doBlink=false;}
else{this.getWindowElement().removeClassName(this._getBaseClassname()+"_blink");doBlink=true;}
if(count<this._maxblink){count++
this.blink.bind(this,event,doBlink,count).delay(0.05);}}},_rebindWindowObjectGetters:function(){var els=this._decorated._addWindowObjectGetters();els.each(function(el){el.getWJWindowObject=el.getWJWindowObject.bind(this);},this);return els;}});var WJWindowMessageDialog=Class.create(WJWindowModal,{initialize:function($super,toDecorate){$super(toDecorate);this.center();this.keepCentered();this._drawDefaultContent();this._buttons=null;this._addButtons();},_drawDefaultContent:function(){var content=this.getContentElement("main");var replaces=this._getTemplateValues();var template=this._getTemplate();content.innerHTML=template.evaluate(replaces);this._contentElements["message"]=content.down("."+replaces.classprefix+"_message");},_getTemplateValues:function(){return{"classprefix":this._getBaseClassname(),"windowtype":this._type};},_addButtons:function(){if(this._buttons==null){this._buttons=new Hash();this._buttons.set("ok",WJButton.create(this._decorated.translate("OK"),"true",true,this.getContentElement("buttons"))).focus();}
return this._buttons;},_getTemplate:function(){return new Template("<div class='#{classprefix}_messageicon #{classprefix}_messageicon_#{windowtype}'>&#160;</div><div class='#{classprefix}_message'>&#160;</div>");},setMessage:function(message,allowHTML){var allowHTML=!!allowHTML;if(!allowHTML){message=message.stripTags();}
this.message=message.stripScripts().split("\n").join("<br/>");this.getContentElement("message").innerHTML=this.message;},_callback:function(){this.hide();return this._decorated._callback.apply(this._decorated,$A(arguments));}});var WJWindowAlert=Class.create(WJWindowMessageDialog,{initialize:function($super,toDecorate){if(!this._type){this._type="alert";}
$super(toDecorate);this.getListener("close").callback.setArgument(0,true);this.removeListener("false");this.removeListener("save");this.removeListener("cancel");}});var WJWindowConfirm=Class.create(WJWindowMessageDialog,{initialize:function($super,toDecorate){if(typeof(this._type)=="undefined"){this._type="confirm";}
$super(toDecorate);},_addButtons:function($super){this._buttons=$super();this._buttons.set("cancel",WJButton.create(this._decorated.translate("CANCEL"),"false",false,this.getContentElement("buttons")));return this._buttons;}});var WJWindowBooleanConfirm=Class.create(WJWindowConfirm,{initialize:function($super,toDecorate){this._type="booleanconfirm";$super(toDecorate);},_addButtons:function($super){this._buttons=$super();this._buttons.get("ok").updateCaption(this._decorated.translate("YES"));this._buttons.get("cancel").updateCaption(this._decorated.translate("NO"));return this._buttons;}});var WJWindowPrompt=Class.create(WJWindowMessageDialog,{initialize:function($super,toDecorate){this._type="prompt";$super(toDecorate);this.getInput().focus();},_getTemplate:function($super){var template=$super();template.template+="<input/>";return template;},_addButtons:function($super){$super();WJButton.create(this._decorated.translate("CANCEL"),"false",false,this.getContentElement("buttons"));},windowResult:function(event,result){if(result){this._callback(event,this.getInput().value);}
else{this._callback(event,"");}},getInput:function(){if(!this._input){this._input=this.getWindowElement().getElementsByTagName("input")[0];}
return this._input;}});var WJButton=Class.create({initialize:function(caption,eventHandler,defaultButton,parentElement){WJDebugger.log(WJDebugger.INFO,"Create new button",caption,eventHandler,defaultButton,parentElement);this._caption=caption;this._eventHandler=eventHandler;this._defaultButton=(defaultButton===true)?true:false;this._parentElement=$(parentElement);this._buildEventHandler();this._createButton();this._addButtonMethods();this._addObserver();if(Object.isElement(this._parentElement)){this._parentElement.appendChild(this.getButton());}
this.updateCaption(this._caption);},_addButtonMethods:function(){this.getButton().updateCaption=this.updateCaption.bind(this);this.getButton().setCaption=this.getButton().updateCaption;this.getButton().getCaption=this.getCaption.bind(this);this.getButton().enable=this.enable.bind(this);this.getButton().disable=this.disable.bind(this);},updateCaption:function(caption){this._caption=caption.stripTags().stripScripts();return this._setCaption.bind(this).defer();},setCaption:function(caption){this.updateCaption(caption);},_setCaption:function(){var contentElement=this.getContentElement();contentElement.update(this._caption);this.setWidth(this._getNewButtonWidth(this._caption,contentElement));return this.getButton();},enable:function(){this.getButton().removeAttribute("disabled");this.getButton().removeClassName("wjgui_button_disabled");return this;},disable:function(){this.getButton().disabled="disabled";this.getButton().addClassName("wjgui_button_disabled");return this;},getContentElement:function(){return this.getButton().down("."+this._getBaseClassName()+"_content");},_getNewButtonWidth:function(text,element){var fontfamily=element.getStyle("fontFamily");var fontsize=element.getStyle("fontSize");var fontweight=element.getStyle("fontWeight");WJButton.measureElement.setStyle({"fontFamily":fontfamily,"fontSize":fontsize,"fontWeight":fontweight}).update(text);var width=document.body.appendChild(WJButton.measureElement).getWidth();WJButton.measureElement.remove();width+=this.getWidth()-element.getWidth();return(width>100||this.getButton().up("div.autowidth",0))?width:100;},getWidth:function(){return this.getButton().getWidth();},setWidth:function(width){this.getButton().setStyle({"width":width+"px"});},_buildEventHandler:function(){if(!Object.isFunction(this._eventHandler)){if(this._eventHandler.indexOf(":")==-1){this._eventHandler=this._getEventPrefix()+":"+this._eventHandler;WJDebugger.log(WJDebugger.INFO,"Build event handler for this, create event "+this._eventHandler);var func=function(event,eventHandler){WJDebugger.log(WJDebugger.INFO,"Fire event in WJButton",event,eventHandler);Event.element(event).fire(eventHandler);}.bindAsEventListener(this.getButton(),this._eventHandler);this._eventHandler=func;}}},_getEventPrefix:function(){return"wjgui";},_createButton:function(){this._buttonElement=new Element("button");var template=this._getTemplate();var replaces={};replaces.classprefix=this._getBaseClassName();this._buttonElement.className=replaces.classprefix+" "+replaces.classprefix+"_"+((this._defaultButton)?"":"no")+"default";this._buttonElement.innerHTML=template.evaluate(replaces);},_getBaseClassName:function(){return"wjgui_button";},_getTemplate:function(){return new Template("<div class='#{classprefix}_left #{classprefix}_column'><div class='#{classprefix}_right #{classprefix}_column'><div class='#{classprefix}_center #{classprefix}_column'><div class='#{classprefix}_content'>&#160;</div></div></div></div>");},getButton:function(){return this._buttonElement;},_addObserver:function(){WJDebugger.log(WJDebugger.INFO,"_addObserver in WJButton",this._eventHandler);WJDebugger.log(WJDebugger.DEBUG,"WJButton observer code",this._eventHandler.toString());Event.observe(this.getButton(),"click",this._eventHandler);},setObserver:function(eventHandler){Event.stopObserving(this.getButton(),"click",this._eventHandler);this._eventHandler=eventHandler;this._addObserver();},getCaption:function(){return this._caption;},recalculateWidth:function(){this.updateCaption(this.getCaption());}});WJButton.measureElement=new Element("div",{"style":"position: absolute; left: -1000px;"});WJButton.create=function(caption,eventHandler,defaultButton,parentElement){var button=new WJButton(caption,eventHandler,defaultButton,parentElement);return button.getButton();}
WJButton.toWJButtonStyle=function(element,defaultButton){if(element.tagName.toLowerCase()=="button"){var element=$(element);var caption=element.getTextContent();var template=WJButton.prototype._getTemplate();var replaces={classprefix:WJButton.prototype._getBaseClassName()};element.className=replaces.classprefix+" "+replaces.classprefix+"_"+((defaultButton)?"":"no")+"default";element.update(template.evaluate(replaces));element.down("."+replaces.classprefix+"_content").update(caption);}
return element;}
var WJModalLayer=Class.create({initialize:function(parent,modalLayer){var parent=parent||document.body;this._modalLayer=(modalLayer||new Element("div"));Element.extend(this._modalLayer).addClassName("wjgui_window_modality");parent.appendChild(this._modalLayer);this._removed=false;this._absolutizeTopLeft();this._fillViewport();Event.observe(window,"resize",this._fillViewport.bind(this,this._modalLayer));},_absolutizeTopLeft:function(element){var element=this._modalLayer;element.absolutize();element.setStyle({left:0,top:0,zIndex:2147483647});},_fillViewport:function(){var element=$(this._modalLayer);if($(element.parentNode)&&$(element.parentNode).getHeight){element.setStyle({width:$(element.parentNode).getWidth()+"px",height:$(element.parentNode).getHeight()+"px"});}
else{element.setStyle({width:document.viewport.getWidth()+"px",height:document.viewport.getHeight()+"px"});}},getLayer:function(){return this._modalLayer;},destroy:function(){if(!this._removed){this._modalLayer.remove();this._removed=true;}}});var WJWindowGooglemaps=Class.create({initialize:function(toDecorate,kmlname,sitename){this._decorate(toDecorate);this._addClassNames(kmlname,sitename);if(typeof(kmlname)!="undefined"){this.setTheme(kmlname);}
this._addPushpinWindowConnector();this._saveStyleSettings();},_addPushpinWindowConnector:function(){this._pushpinwindowconnector=new Element("div",{"class":"pushpinwindowconnector","style":"position: absolute;"});this.getWindowElement().insert(new Element("div",{"style":"position: relative; overflow: visible; height: 0px; width: 0px;"}).insert(this._pushpinwindowconnector));},getPushpinWindowConnectorElement:function(){return this._pushpinwindowconnector;},_saveStyleSettings:function(){var wasVisible=this.isVisible();var origX=this.getX();var origY=this.getY();if(!wasVisible){this.setX(-10000);this.setY(-10000);this.show();}
this._stylesettings=new Hash();this._stylesettings.set("pushpinwindowconnector-top",parseInt(this._pushpinwindowconnector.getStyle("top")));this._stylesettings.set("pushpinwindowconnector-left",parseInt(this._pushpinwindowconnector.getStyle("left")));this._stylesettings.set("pushpinwindowconnector-height",this._pushpinwindowconnector.getHeight());if(!wasVisible){this.hide();this.setX(origX);this.setY(origY);}},getStyleSetting:function(setting){return this._stylesettings.get(setting);},_addClassNames:function(kmlname,sitename){var classname=this._getBaseClassname()+"_googlemaps";var element=this.getWindowElement()
element.addClassName(classname);if(typeof(sitename)!="undefined"){element.addClassName(classname+"_"+sitename);}},_decorate:function(toDecorate){this._decorated=toDecorate;for(property in this._decorated){if(!Object.isFunction(this[property])){this[property]=this._decorated[property];}}},fireClose:function(element){this.hide();},getFullHeight:function(){return this.getHeight()+(this._stylesettings.get("pushpinwindowconnector-height")+this._stylesettings.get("pushpinwindowconnector-top"));}});var WJWindowNotice=Class.create(WJWindowAlert,{initialize:function($super,toDecorate){this._type="notice";$super(toDecorate);}});var WJWrappedPane=Class.create({initialize:function(element){this.element=$(element);WJDebugger.log(WJDebugger.INFO,"Create new wrapped pane",element);$(this.element.parentNode).insertBefore(this._createWrapper(),this.element).down(".wjgui_wrappedpane_main").down(".wjgui_wrappedpane_content").update("").appendChild(this.element);},_createWrapper:function(){var template=new Template("<div class='wjgui_wrappedpane_#{rowname}'><div class='wjgui_wrappedpane_left wjgui_wrappedpane_column'><div class='wjgui_wrappedpane_right wjgui_wrappedpane_column'><div class='wjgui_wrappedpane_center wjgui_wrappedpane_column'><div class='wjgui_wrappedpane_content'>&#160;</div></div></div></div></div>");var content=["top","main","bottom"].inject("",function(content,rowname){return content+template.evaluate({rowname:rowname});});return new Element("div",{"class":"wjgui_wrappedpane"}).update(content);}});